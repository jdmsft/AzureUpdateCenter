{
  "contentVersion": "1.0.0.0",
  "parameters": {
  },
  "variables": {
    "workbookDisplayName": "Azure Update Center",
    "workbookUri": "https://github.com/jdmsft/AzureUpdateCenter",
    "workbookVersion": "1.2.0",
    "workbookId": "[guid(resourceGroup().id, deployment().name)]",
    "workbookFullDisplayName": "[concat(variables('workbookDisplayName'),' v',variables('workbookVersion'),' - ',substring(variables('workbookId'),0,8))]",
    "workbookType": "workbook",
    "workbookSourceId": "azure monitor",
    "workbookContent": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "**INTERNAL PARAMETERS - DO NOT EDIT OR REMOVE THE SETTINGS BELOW!**",
                  "style": "warning"
                },
                "conditionalVisibility": {
                  "parameterName": "unhideInternalParams",
                  "comparison": "isEqualTo",
                  "value": "true"
                },
                "name": "group-internal-text-up"
              },
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "parameters": [
                    {
                      "id": "0f274158-3b41-4347-8206-fe03ccae3d7c",
                      "version": "KqlParameterItem/1.0",
                      "name": "wbSolution",
                      "value": "[variables('workbookUri')]",
                      "type": 1,
                      "isRequired": true,
                      "isHiddenWhenLocked": true,
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    },
                    {
                      "id": "b14633bf-2541-4ab3-8aa7-17a71d267109",
                      "version": "KqlParameterItem/1.0",
                      "name": "wbId",
                      "value": "[variables('workbookId')]",
                      "type": 1,
                      "isRequired": true,
                      "isHiddenWhenLocked": true,
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    },
                    {
                      "id": "2a773da0-59b1-472a-abed-375180360216",
                      "version": "KqlParameterItem/1.0",
                      "name": "wbVersion",
                      "value": "[variables('workbookVersion')]",
                      "type": 1,
                      "isRequired": true,
                      "isHiddenWhenLocked": true,
                      "timeContext": {
                        "durationMs": 86400000
                      }
                    },
                    {
                      "id": "5ba2bb47-9360-4b3d-a537-4039ac9f6683",
                      "version": "KqlParameterItem/1.0",
                      "name": "wbUpdate",
                      "type": 1,
                      "isRequired": true,
                      "query": "{\"version\":\"CustomEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"url\":\"https://jdmsft.azurewebsites.net/api/update\",\"contentType\":\"text/plain\",\"urlParams\":[{\"key\":\"sol\",\"value\":\"{wbSolution}\"},{\"key\":\"id\",\"value\":\"{wbId}\"},{\"key\":\"ver\",\"value\":\"{wbVersion}\"}],\"transformers\":null}",
                      "isHiddenWhenLocked": true,
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 10
                    },
                    {
                      "id": "5be38392-1b0e-4a28-9850-4227fc7fbf3e",
                      "version": "KqlParameterItem/1.0",
                      "name": "wbCustomBannerType",
                      "type": 1,
                      "isRequired": true,
                      "query": "{\"version\":\"1.0.0\",\"content\":\"{wbUpdate}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.customMsgType\",\"columns\":[]}}]}",
                      "isHiddenWhenLocked": true,
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 8
                    },
                    {
                      "id": "8b770ddf-a4d5-49e0-9e58-147398434534",
                      "version": "KqlParameterItem/1.0",
                      "name": "wbCustomBannerMsg",
                      "type": 1,
                      "isRequired": true,
                      "query": "{\"version\":\"1.0.0\",\"content\":\"{wbUpdate}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.customMsg\",\"columns\":[]}}]}",
                      "isHiddenWhenLocked": true,
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 8
                    },
                    {
                      "version": "KqlParameterItem/1.0",
                      "name": "wbUpdateBannerType",
                      "type": 1,
                      "isRequired": true,
                      "query": "{\"version\":\"1.0.0\",\"content\":\"{wbUpdate}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.updateMsgType\",\"columns\":[]}}]}",
                      "isHiddenWhenLocked": true,
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 8,
                      "id": "8d8f7e75-9dc7-4fb3-87f3-738f9f2553a8"
                    },
                    {
                      "version": "KqlParameterItem/1.0",
                      "name": "wbUpdateBannerMsg",
                      "type": 1,
                      "isRequired": true,
                      "query": "{\"version\":\"1.0.0\",\"content\":\"{wbUpdate}\",\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.updateMsg\",\"columns\":[]}}]}",
                      "isHiddenWhenLocked": true,
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 8,
                      "id": "2e703258-b211-46be-a0da-0d5276327ef9"
                    }
                  ],
                  "style": "pills",
                  "queryType": 10
                },
                "conditionalVisibility": {
                  "parameterName": "unhideInternalParams",
                  "comparison": "isEqualTo",
                  "value": "true"
                },
                "name": "group-internal-params"
              },
              {
                "type": 1,
                "content": {
                  "json": "**LOADING...**\r\n\r\n**If it's the first time you run this workbook, you first need to trust this workbook to enable all its features!** \r\n\r\n**To trust this workbook**: \r\n* Click on <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-pencil\" viewBox=\"0 0 16 16\">\r\n  <path d=\"M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z\"/>\r\n</svg> **Edit** button on the menu above\r\n* Click on <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-gear\" viewBox=\"0 0 16 16\">\r\n  <path d=\"M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z\"/>\r\n  <path d=\"M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z\"/>\r\n</svg> button\r\n* Select <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-globe\" viewBox=\"0 0 16 16\">\r\n  <path d=\"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z\"/>\r\n</svg> **Trusted hosts** tab\r\n* Check <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-check-square-fill\" viewBox=\"0 0 16 16\">\r\n  <path d=\"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z\"/>\r\n</svg> **Mark Workbook as trusted**\r\n* Click on **Save and Close** button\r\n* Click on <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-journal-album\" viewBox=\"0 0 16 16\">\r\n  <path d=\"M5.5 4a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-5zm1 7a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3z\"/>\r\n  <path d=\"M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z\"/>\r\n  <path d=\"M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z\"/>\r\n</svg> **Done Editing** from the menu above\r\n* Finally click on <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-arrow-clockwise\" viewBox=\"0 0 16 16\">\r\n  <path fill-rule=\"evenodd\" d=\"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z\"/>\r\n  <path d=\"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z\"/>\r\n</svg> to refresh your workbook. \r\n\r\n**If you already trusted this workbook**: just wait for the loading to finish ⌛\r\n\r\n**If you don't want to trust this workbook**: just delete it! 🙂",
                  "style": "info"
                },
                "conditionalVisibility": {
                  "parameterName": "wbUpdate",
                  "comparison": "isEqualTo",
                  "value": ""
                },
                "name": "group-internal-banner-trust"
              },
              {
                "type": 1,
                "content": {
                  "json": "{wbUpdateBannerMsg}",
                  "style": "{wbUpdateBannerType}"
                },
                "conditionalVisibility": {
                  "parameterName": "wbUpdateBannerMsg",
                  "comparison": "isNotEqualTo"
                },
                "name": "group-internal-msg-version"
              },
              {
                "type": 1,
                "content": {
                  "json": "{wbCustomBannerMsg}",
                  "style": "{wbCustomBannerType}"
                },
                "conditionalVisibility": {
                  "parameterName": "wbCustomBannerMsg",
                  "comparison": "isNotEqualTo"
                },
                "name": "group-internal-msg-custom"
              },
              {
                "type": 1,
                "content": {
                  "json": "**INTERNAL PARAMETERS - DO NOT EDIT OR REMOVE THE SETTINGS BELOW!**",
                  "style": "warning"
                },
                "conditionalVisibility": {
                  "parameterName": "unhideInternalParams",
                  "comparison": "isEqualTo",
                  "value": "true"
                },
                "name": "group-internal-text-down"
              }
            ]
          },
          "name": "group-internal"
        },
        {
          "type": 1,
          "content": {
            "json": "# Azure Update Center\r\n*Version 1.0 BETA (04/2022) - Made by* [***JDMSFT***](https://github.com/jdmsft)\r\n\r\nThis workbook is intended to give an overview of your Azure IaaS services updates which leverage [**Automatic VM Guest Patching**](https://docs.microsoft.com/azure/virtual-machines/automatic-vm-guest-patching) and [**Azure Update Management**](https://docs.microsoft.com/azure/automation/update-management) features.\r\n\r\nUse the global filter below to properly define the global data context of this workbook."
          },
          "name": "title"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "crossComponentResources": [
              "{Subscriptions}"
            ],
            "parameters": [
              {
                "id": "9bcef3a8-0a53-4f08-a99b-84d48abf9ffd",
                "version": "KqlParameterItem/1.0",
                "name": "Tenants",
                "type": 7,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "resourcecontainers\r\n| distinct tenantId",
                "crossComponentResources": [
                  "value::all"
                ],
                "isHiddenWhenLocked": true,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ]
                },
                "defaultValue": "value::all",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              },
              {
                "id": "725a842b-1fa8-493f-9dd4-03f10dbb8fdf",
                "version": "KqlParameterItem/1.0",
                "name": "Subscriptions",
                "type": 6,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "value": [
                  "value::all"
                ],
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "includeAll": true,
                  "selectAllValue": "",
                  "showDefault": false
                },
                "defaultValue": "value::all"
              },
              {
                "id": "79b9e243-24da-4d52-bf5c-5597f110803c",
                "version": "KqlParameterItem/1.0",
                "name": "UpdatesWorkspacesGlobal",
                "label": "Updates Workspaces (Global)",
                "type": 5,
                "isRequired": true,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "query": "resources\r\n| where ['type'] == \"microsoft.operationsmanagement/solutions\" and name contains \"Updates(\"\r\n| extend workspaceId = tostring(properties.workspaceResourceId)\r\n| summarize by workspaceId, tenantId, subscriptionId",
                "crossComponentResources": [
                  "{Subscriptions}"
                ],
                "isHiddenWhenLocked": true,
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "showDefault": false
                },
                "defaultValue": "value::all",
                "queryType": 1,
                "resourceType": "microsoft.resourcegraph/resources"
              }
            ],
            "style": "pills",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          "name": "Parameters"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "## Azure Virtual Machines\r\n\r\nIf **Automatic VM Guest Patching** is enabled on a VM, then the available **Critical** and **Security** patches are downloaded and applied automatically on the VM. This process kicks off automatically every month when new patches are released. Patch assessment and installation are automatic, and the process includes rebooting the VM as required. Patches are installed within 30 days of the monthly patch releases. More details about **Automatic VM Guest Patching** [here](https://docs.microsoft.com/en-us/azure/virtual-machines/automatic-vm-guest-patching)."
                },
                "name": "text - 0"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "resources\r\n| where type == 'microsoft.compute/virtualmachines' and properties.storageProfile.osDisk.osType == 'Linux'\r\n| extend AutomaticUpdates = properties.osProfile.linuxConfiguration.enableAutomaticUpdates\r\n| extend PatchMode = properties.osProfile.linuxConfiguration.patchSettings.patchMode\r\n| extend AssessmentMode = properties.osProfile.linuxConfiguration.patchSettings.assessmentMode\r\n| extend VmOS = properties.storageProfile.osDisk.osType\r\n| extend VmState = strcat_array(split(properties.extended.instanceView.powerState.code,\"/\",1),\"\")\r\n| extend VM = id\r\n| union (\r\nresources\r\n    | where type == 'microsoft.compute/virtualmachines' and properties.storageProfile.osDisk.osType == 'Windows'\r\n    | extend AutomaticUpdates = properties.osProfile.windowsConfiguration.enableAutomaticUpdates\r\n    | extend PatchMode = properties.osProfile.windowsConfiguration.patchSettings.patchMode\r\n    | extend AssessmentMode = properties.osProfile.windowsConfiguration.patchSettings.assessmentMode\r\n    | extend HotPatching = properties.osProfile.windowsConfiguration.patchSettings.enableHotpatching\r\n    | extend VmOS = properties.storageProfile.osDisk.osType\r\n    | extend VmState = strcat_array(split(properties.extended.instanceView.powerState.code,\"/\",1),\"\")\r\n    | extend VM = id\r\n)\r\n| project VM, tostring(VmOS), VmState, tostring(AutomaticUpdates), tostring(PatchMode), tostring(HotPatching), Subscription=strcat(\"/subscriptions/\",subscriptionId)\r\n| summarize count() by VmOS",
                  "size": 3,
                  "title": "Operating System",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "visualization": "piechart",
                  "chartSettings": {
                    "seriesLabelSettings": [
                      {
                        "seriesName": "true",
                        "label": "Enabled",
                        "color": "green"
                      },
                      {
                        "seriesName": "",
                        "label": "Not defined",
                        "color": "orange"
                      },
                      {
                        "seriesName": "false",
                        "label": "Disabled",
                        "color": "redBright"
                      },
                      {
                        "seriesName": "Windows",
                        "color": "blue"
                      },
                      {
                        "seriesName": "Linux",
                        "color": "yellow"
                      }
                    ]
                  }
                },
                "customWidth": "33",
                "name": "Chart-OperatingSystem"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "resources\r\n| where type == 'microsoft.compute/virtualmachines' and properties.storageProfile.osDisk.osType == 'Linux'\r\n| extend AutomaticUpdates = properties.osProfile.linuxConfiguration.enableAutomaticUpdates\r\n| extend PatchMode = properties.osProfile.linuxConfiguration.patchSettings.patchMode\r\n| extend AssessmentMode = properties.osProfile.linuxConfiguration.patchSettings.assessmentMode\r\n| extend VmOS = properties.storageProfile.osDisk.osType\r\n| extend VmState = strcat_array(split(properties.extended.instanceView.powerState.code,\"/\",1),\"\")\r\n| extend VM = id\r\n| union (\r\nresources\r\n    | where type == 'microsoft.compute/virtualmachines' and properties.storageProfile.osDisk.osType == 'Windows'\r\n    | extend AutomaticUpdates = properties.osProfile.windowsConfiguration.enableAutomaticUpdates\r\n    | extend PatchMode = properties.osProfile.windowsConfiguration.patchSettings.patchMode\r\n    | extend AssessmentMode = properties.osProfile.windowsConfiguration.patchSettings.assessmentMode\r\n    | extend HotPatching = properties.osProfile.windowsConfiguration.patchSettings.enableHotpatching\r\n    | extend VmOS = properties.storageProfile.osDisk.osType\r\n    | extend VmState = strcat_array(split(properties.extended.instanceView.powerState.code,\"/\",1),\"\")\r\n    | extend VM = id\r\n)\r\n| project VM, tostring(VmOS), VmState, tostring(AutomaticUpdates), tostring(PatchMode), tostring(HotPatching), Subscription=strcat(\"/subscriptions/\",subscriptionId)\r\n| summarize count() by AutomaticUpdates",
                  "size": 3,
                  "title": "Automatic Updates",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "visualization": "piechart",
                  "chartSettings": {
                    "seriesLabelSettings": [
                      {
                        "seriesName": "true",
                        "label": "Enabled",
                        "color": "green"
                      },
                      {
                        "seriesName": "",
                        "label": "Not defined",
                        "color": "orange"
                      },
                      {
                        "seriesName": "false",
                        "label": "Disabled",
                        "color": "redBright"
                      }
                    ]
                  }
                },
                "customWidth": "33",
                "name": "Chart-AutomaticUpdates"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "resources\r\n| where type == 'microsoft.compute/virtualmachines' and properties.storageProfile.osDisk.osType == 'Linux'\r\n| extend AutomaticUpdates = properties.osProfile.linuxConfiguration.enableAutomaticUpdates\r\n| extend PatchMode = properties.osProfile.linuxConfiguration.patchSettings.patchMode\r\n| extend AssessmentMode = properties.osProfile.linuxConfiguration.patchSettings.assessmentMode\r\n| extend VmOS = properties.storageProfile.osDisk.osType\r\n| extend VmState = strcat_array(split(properties.extended.instanceView.powerState.code,\"/\",1),\"\")\r\n| extend VM = id\r\n| union (\r\nresources\r\n    | where type == 'microsoft.compute/virtualmachines' and properties.storageProfile.osDisk.osType == 'Windows'\r\n    | extend AutomaticUpdates = properties.osProfile.windowsConfiguration.enableAutomaticUpdates\r\n    | extend PatchMode = properties.osProfile.windowsConfiguration.patchSettings.patchMode\r\n    | extend AssessmentMode = properties.osProfile.windowsConfiguration.patchSettings.assessmentMode\r\n    | extend HotPatching = properties.osProfile.windowsConfiguration.patchSettings.enableHotpatching\r\n    | extend VmOS = properties.storageProfile.osDisk.osType\r\n    | extend VmState = strcat_array(split(properties.extended.instanceView.powerState.code,\"/\",1),\"\")\r\n    | extend VM = id\r\n)\r\n| project VM, tostring(VmOS), VmState, tostring(AutomaticUpdates), tostring(PatchMode), tostring(HotPatching), Subscription=strcat(\"/subscriptions/\",subscriptionId)\r\n| summarize count() by PatchMode",
                  "size": 3,
                  "title": "Patch Mode",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "visualization": "piechart",
                  "chartSettings": {
                    "seriesLabelSettings": [
                      {
                        "seriesName": "AutomaticByOS",
                        "label": "Managed by Windows",
                        "color": "blue"
                      },
                      {
                        "seriesName": "ImageDefault",
                        "label": "Managed by Linux",
                        "color": "yellow"
                      },
                      {
                        "seriesName": "",
                        "label": "Not defined",
                        "color": "redBright"
                      },
                      {
                        "seriesName": "AutomaticByPlatform",
                        "label": "Managed by Azure",
                        "color": "blueDark"
                      },
                      {
                        "seriesName": "Manual",
                        "label": "Manual (Windows)",
                        "color": "orange"
                      }
                    ]
                  }
                },
                "customWidth": "33",
                "name": "Chart-PatchMode"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "resources\r\n| where type == 'microsoft.compute/virtualmachines' and properties.storageProfile.osDisk.osType == 'Linux'\r\n| extend autoUpdates = properties.osProfile.linuxConfiguration.enableAutomaticUpdates\r\n| extend patchMode = properties.osProfile.linuxConfiguration.patchSettings.patchMode\r\n| extend assessmentMode = properties.osProfile.linuxConfiguration.patchSettings.assessmentMode\r\n| extend vmOS = properties.storageProfile.osDisk.osType\r\n| extend vmState = strcat_array(split(properties.extended.instanceView.powerState.code,\"/\",1),\"\")\r\n| extend vmId = tolower(id)\r\n| union (\r\nresources\r\n    | where type == 'microsoft.compute/virtualmachines' and properties.storageProfile.osDisk.osType == 'Windows'\r\n    | extend autoUpdates = properties.osProfile.windowsConfiguration.enableAutomaticUpdates\r\n    | extend patchMode = properties.osProfile.windowsConfiguration.patchSettings.patchMode\r\n    | extend assessmentMode = properties.osProfile.windowsConfiguration.patchSettings.assessmentMode\r\n    | extend hotPatching = properties.osProfile.windowsConfiguration.patchSettings.enableHotpatching\r\n    | extend vmOS = properties.storageProfile.osDisk.osType\r\n    | extend vmState = strcat_array(split(properties.extended.instanceView.powerState.code,\"/\",1),\"\")\r\n    | extend vmId = tolower(id)\r\n)\r\n| join kind=leftouter (\r\n    resources\r\n    | extend extensionType = properties.type\r\n    | where type == 'microsoft.compute/virtualmachines/extensions' and extensionType =~ 'MicrosoftMonitoringAgent' or extensionType =~ 'OMSAgentForLinux'\r\n    | extend vmId = tolower(substring(id, 0, indexof(id, '/extensions')))\r\n    | extend logAnalyticsAgent = \"Enabled\"\r\n    | extend logAnalyticsAgentWorkspace = properties.settings.workspaceId\r\n    | extend logAnalyticsAgentDetails = properties\r\n    | join kind=leftouter (\r\n        resources\r\n        | extend extensionType = properties.type\r\n        | where type == 'microsoft.compute/virtualmachines/extensions' and extensionType =~ 'AzureMonitorWindowsAgent' or extensionType =~ 'AzureMonitorLinuxAgent'\r\n        | extend vmId = tolower(substring(id, 0, indexof(id, '/extensions')))\r\n        | extend azureMonitorAgent = \"Enabled\"\r\n        | extend azureMonitorAgentDetails = properties)\r\n    on vmId)\r\non vmId\r\n| join kind=leftouter (\r\n    patchinstallationresources\r\n    | where type == 'microsoft.compute/virtualmachines/patchinstallationresults'\r\n    | extend vmId = tolower(substring(id, 0, indexof(id, '/patchInstallationResults')))\r\n    | extend lastUpdateDate = properties.startDateTime\r\n    | extend lastUpdateReportSource = \"ResourceGraph\"\r\n    | extend lastUpdateDetails = properties\r\n    | project vmId, tostring(lastUpdateDate), tostring(lastUpdateReportSource), lastUpdateDetails\r\n    | order by tostring(lastUpdateDate) desc\r\n    | summarize arg_max(lastUpdateDate,*) by vmId)\r\non vmId\r\n| extend vmName = tostring(strcat_array(split(vmId,\"/\",8),\"\"))\r\n| project vmId=tolower(vmId), vmName, tostring(vmOS), vmState, tostring(autoUpdates), tostring(patchMode), tostring(hotPatching), logAnalyticsAgent, azureMonitorAgent, lastUpdateDate, lastUpdateReportSource, lastUpdateDetails, logAnalyticsAgentDetails, azureMonitorAgentDetails\r\n| order by vmName asc",
                  "size": 0,
                  "title": "Resource Graph Dataset",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "hideDatasets",
                  "comparison": "isEqualTo",
                  "value": "false"
                },
                "name": "query-vms-graph"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "Update\r\n| where ComputerEnvironment == \"Azure\" and ResourceType == \"virtualMachines\"\r\n| extend vmId = tolower(ResourceId)\r\n| distinct vmId\r\n| join kind=leftouter (\r\n    Update\r\n    | extend vmId = tolower(ResourceId)\r\n    | where ResourceType == \"virtualMachines\"\r\n    | summarize arg_max(PublishedDate,*) by vmId\r\n    | project vmId, lastUpdateDate=PublishedDate, computerId=SourceComputerId)\r\non vmId\r\n| join kind=leftouter (\r\n    Heartbeat\r\n    | where ResourceType == \"virtualMachines\"\r\n    | extend vmId = tolower(ResourceId)\r\n    | summarize arg_max(TimeGenerated,*) by vmId\r\n    | project vmId, lastAgentHeartbeat=TimeGenerated,lastAgentHeartbeatType=Category)\r\non vmId\r\n| extend lastUpdateReportSource = \"LogAnalytics\"\r\n| project vmId, lastUpdateDate, lastUpdateReportSource, lastAgentHeartbeat, lastAgentHeartbeatType, computerId\r\n| order by tostring(strcat_array(split(vmId,\"/\",8),\"\")) asc",
                  "size": 0,
                  "title": "Log Analytics Dataset",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{UpdatesWorkspacesGlobal}"
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "hideDatasets",
                  "comparison": "isEqualTo",
                  "value": "false"
                },
                "name": "query-vms-logs"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\",\"mergeType\":\"leftouter\",\"leftTable\":\"query-vms-graph\",\"rightTable\":\"query-vms-logs\",\"leftColumn\":\"vmId\",\"rightColumn\":\"vmId\"}],\"projectRename\":[{\"originalName\":\"[query-vms-graph].vmId\",\"mergedName\":\"vmId\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-graph].vmName\",\"mergedName\":\"vmName\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-graph].vmOS\",\"mergedName\":\"vmOS\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-graph].vmState\",\"mergedName\":\"vmState\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-graph].autoUpdates\",\"mergedName\":\"autoUpdates\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-graph].patchMode\",\"mergedName\":\"patchMode\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-graph].hotPatching\",\"mergedName\":\"hotPatching\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-graph].logAnalyticsAgentDetails\",\"mergedName\":\"legacyAgent\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-graph].azureMonitorAgentDetails\",\"mergedName\":\"modernAgent\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-graph].lastUpdateDate\",\"mergedName\":\"lastDataFromGraph\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-logs].lastUpdateDate\",\"mergedName\":\"lastDataDataFromLogs\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query-vms-logs].computerId\",\"mergedName\":\"computerId\",\"fromId\":\"c73b29d4-e0a5-4750-93c1-c2e835c440ec\"},{\"originalName\":\"[query -vms-logs].vmId\"},{\"originalName\":\"[query -vms-logs].lastUpdateReportSource\"},{\"originalName\":\"[query-vms-graph].lastUpdateReportSource\"},{\"originalName\":\"[query -vms-logs].lastAgentHeartbeatType\"},{\"originalName\":\"[query -vms-logs].lastAgentHeartbeat\"},{\"originalName\":\"[query-vms-logs].vmId\"},{\"originalName\":\"[query-vms-logs].lastUpdateReportSource\"},{\"originalName\":\"[query-vms-logs].lastAgentHeartbeat\"},{\"originalName\":\"[query-vms-logs].lastAgentHeartbeatType\"},{\"originalName\":\"[query-vms-graph].logAnalyticsAgent\"},{\"originalName\":\"[query-vms-graph].azureMonitorAgent\"},{\"originalName\":\"[query-vms-graph].lastUpdateDetails\"}]}",
                  "size": 0,
                  "title": "Configuration",
                  "exportedParameters": [
                    {
                      "fieldName": "vmId",
                      "parameterName": "selected_vmId",
                      "parameterType": 1
                    },
                    {
                      "fieldName": "computerId",
                      "parameterName": "selected_computerId",
                      "parameterType": 1
                    }
                  ],
                  "queryType": 7,
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "vmId",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "25ch"
                        }
                      },
                      {
                        "columnMatch": "vmName",
                        "formatter": 0,
                        "formatOptions": {
                          "customColumnWidthSetting": "25ch"
                        }
                      },
                      {
                        "columnMatch": "lastDataFromGraph",
                        "formatter": 6,
                        "formatOptions": {
                          "customColumnWidthSetting": "25ch"
                        }
                      },
                      {
                        "columnMatch": "lastDataDataFromLogs",
                        "formatter": 6,
                        "formatOptions": {
                          "customColumnWidthSetting": "25ch"
                        }
                      }
                    ],
                    "sortBy": [
                      {
                        "itemKey": "vmName",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "sortBy": [
                    {
                      "itemKey": "vmName",
                      "sortOrder": 1
                    }
                  ]
                },
                "showPin": false,
                "name": "query-vms-merge"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "Update\r\n| where SourceComputerId == '{selected_computerId}'\r\n| summarize arg_max(TimeGenerated, *) by Computer, SourceComputerId, UpdateID\r\n| project updateId=UpdateID, updatePublishDate=PublishedDate, updateState=UpdateState, classification=Classification, updateProduct=Product, updateDetails=Title, kbId=KBID, updateLogDate=TimeGenerated\r\n| order by updatePublishDate desc ",
                  "size": 0,
                  "title": "Update Summary (for the selected VM)",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{UpdatesWorkspacesGlobal}"
                  ]
                },
                "name": "query -vm-updates"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "patchinstallationresources\r\n| where type == 'microsoft.compute/virtualmachines/patchinstallationresults'\r\n| extend vmId = tolower(substring(id, 0, indexof(id, '/patchInstallationResults')))\r\n| where vmId == '{selected_vmId}'\r\n| extend dateTime = tostring(properties.startDateTime)\r\n| extend status = tostring(properties.status)\r\n| extend rebootStatus = tostring(properties.rebootStatus)\r\n| extend message = tostring(properties.errorDetails.message)\r\n| extend details = properties\r\n| project vmId, dateTime, status, rebootStatus, message, details\r\n| order by tostring(dateTime) desc",
                  "size": 0,
                  "title": "Platform Update Summary (for the selected VM)",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Date",
                        "formatter": 6,
                        "dateFormat": {
                          "formatName": "shortDateTimePattern"
                        }
                      }
                    ]
                  }
                },
                "name": "query-platformupdates"
              }
            ]
          },
          "name": "group-patchconfiguration"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "## Azure Update Management\r\n\r\n**Azure Update Management** use **Azure Automation** and **Log Analytics** to manage operating system updates for your Windows and Linux virtual machines in Azure, physical or VMs in on-premises environments, and in other cloud environments. More details [here](https://docs.microsoft.com/en-us/azure/automation/update-management/overview)."
                },
                "name": "text - 3"
              },
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "tabs",
                  "links": [
                    {
                      "id": "d3bd6ffa-a9b9-43a7-980f-bc2fee84c556",
                      "cellValue": "selectedTab",
                      "linkTarget": "parameter",
                      "linkLabel": "Updates Workspaces",
                      "subTarget": "tab-workspaces",
                      "style": "link"
                    },
                    {
                      "id": "91348a0f-f867-40e4-b131-20a58e8f6d10",
                      "cellValue": "selectedTab",
                      "linkTarget": "parameter",
                      "linkLabel": "Updates Workspaces Virtual Machines",
                      "subTarget": "tab-vms",
                      "style": "link"
                    },
                    {
                      "id": "d2a64a16-e7d8-4d73-bc73-c792a8d742e0",
                      "cellValue": "selectedTab",
                      "linkTarget": "parameter",
                      "linkLabel": "Automation Hybrid Runbook Workers",
                      "subTarget": "tab-hrw",
                      "style": "link"
                    }
                  ]
                },
                "name": "links - 0"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "resources\r\n| where ['type'] == \"microsoft.operationsmanagement/solutions\" and name contains \"Updates(\"\r\n| join kind=leftouter (resourcecontainers | where type==\"microsoft.resources/subscriptions\" | project subscriptionName=name, subscriptionId) on subscriptionId \r\n| extend workspace = tostring(properties.workspaceResourceId)\r\n| summarize by workspace, tenantId, subscriptionName, subscriptionId\r\n",
                  "size": 0,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "gridSettings": {
                    "labelSettings": [
                      {
                        "columnId": "workspace",
                        "label": "Workspace"
                      },
                      {
                        "columnId": "tenantId",
                        "label": "Tenant ID"
                      },
                      {
                        "columnId": "subscriptionName",
                        "label": "Subscription Name"
                      },
                      {
                        "columnId": "subscriptionId",
                        "label": "Subscription ID"
                      }
                    ]
                  }
                },
                "conditionalVisibility": {
                  "parameterName": "selectedTab",
                  "comparison": "isEqualTo",
                  "value": "tab-workspaces"
                },
                "name": "tab-workspaces"
              },
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ],
                  "parameters": [
                    {
                      "id": "066bb362-23bd-44df-bb3b-b0c35f18e128",
                      "version": "KqlParameterItem/1.0",
                      "name": "UpdatesWorkspaces",
                      "label": "Updates Workspaces",
                      "type": 5,
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "resources\r\n| where ['type'] == \"microsoft.operationsmanagement/solutions\" and name contains \"Updates(\"\r\n| extend workspaceId = tostring(properties.workspaceResourceId)\r\n| summarize by workspaceId, tenantId, subscriptionId\r\n",
                      "crossComponentResources": [
                        "{Subscriptions}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "value": [
                        "value::all"
                      ]
                    }
                  ],
                  "style": "pills",
                  "doNotRunWhenHidden": true,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "conditionalVisibility": {
                  "parameterName": "selectedTab",
                  "comparison": "isEqualTo",
                  "value": "tab-vms"
                },
                "name": "parameters - 4"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "Update\r\n| where ComputerEnvironment == \"Azure\" and ResourceType == \"virtualMachines\"\r\n| extend vmId = tolower(ResourceId)\r\n| distinct vmId\r\n| join kind=leftouter (\r\n    Update\r\n    | where UpdateState == \"Installed\" and ComputerEnvironment == \"Azure\" and ResourceType == \"virtualMachines\"\r\n    | summarize arg_max(TimeGenerated,*) by Computer\r\n    | extend vmId = tolower(ResourceId)\r\n    | extend lastUpdateDate = TimeGenerated\r\n    | extend lastUpdateKB = KBID\r\n    | extend lastUpdateType = Classification\r\n    | extend lastUpdateSeverity = MSRCSeverity)\r\non vmId\r\n| project vmId, lastUpdateDate, lastUpdateKB, lastUpdateType, lastUpdateSeverity\r\n| order by tostring(strcat_array(split(vmId,\"/\",8),\"\")) asc",
                  "size": 0,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "exportFieldName": "VirtualMachine",
                  "exportParameterName": "selectedUpdateManagementVM",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "crossComponentResources": [
                    "{UpdatesWorkspaces}"
                  ],
                  "gridSettings": {
                    "labelSettings": [
                      {
                        "columnId": "vmId",
                        "label": "Virtual Machine"
                      },
                      {
                        "columnId": "lastUpdateDate",
                        "label": "Last Update Date"
                      },
                      {
                        "columnId": "lastUpdateKB",
                        "label": "Last Update KB"
                      },
                      {
                        "columnId": "lastUpdateType",
                        "label": "Last Update Type"
                      },
                      {
                        "columnId": "lastUpdateSeverity",
                        "label": "Last Update Severity"
                      }
                    ]
                  }
                },
                "conditionalVisibility": {
                  "parameterName": "selectedTab",
                  "comparison": "isEqualTo",
                  "value": "tab-vms"
                },
                "name": "tab-vms"
              },
              {
                "type": 1,
                "content": {
                  "json": "When **Azure Automation Update Management** is enabled, any machine connected to your Updates workspace is by default automatically configured as a **System Hybrid Runbook Worker**. \r\n\r\n> Because the integration of *Azure Resource Manager* and *Custom Endpoint* workbook data sources is limited, you need to browse each **Automation Accounts** individually below to see associated **System Hybrid runbook Worker** underneath (if applied). When Azure Workbook service will permit it, I will implement an automated process to fetch all **System Hybrid Runbook Workers**. Stay tuned!"
                },
                "conditionalVisibility": {
                  "parameterName": "selectedTab",
                  "comparison": "isEqualTo",
                  "value": "tab-hrw"
                },
                "name": "text-hrw"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "resources\r\n| where type == \"microsoft.automation/automationaccounts\"\r\n| project id, location, properties, identity, resourceGroup, subscriptionId, tenantId",
                  "size": 0,
                  "title": "Automation Accounts",
                  "exportFieldName": "id",
                  "exportParameterName": "selectedAutomationAccount",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{Subscriptions}"
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "selectedTab",
                  "comparison": "isEqualTo",
                  "value": "tab-hrw"
                },
                "name": "query-automationaccounts"
              },
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GETARRAY\",\"path\":\"{selectedAutomationAccount}/hybridRunbookWorkerGroups?api-version=2015-10-31\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":null}",
                  "size": 0,
                  "title": "Hybrid Runbook Workers",
                  "queryType": 12,
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "hybridRunbookWorkers",
                        "formatter": 7,
                        "formatOptions": {
                          "linkTarget": "CellDetails",
                          "linkIsContextBlade": true
                        }
                      }
                    ]
                  }
                },
                "conditionalVisibility": {
                  "parameterName": "selectedTab",
                  "comparison": "isEqualTo",
                  "value": "tab-hrw"
                },
                "name": "query-hrw"
              }
            ]
          },
          "name": "group-updatemanagement"
        },
        {
          "type": 1,
          "content": {
            "json": "---\r\nMade with 💙 by [**JDMSFT**](https://github.com/jdmsft)"
          },
          "name": "footer"
        }
      ],
      "isLocked": false,
      "fallbackResourceIds": [
        "azure monitor"
      ]
    }
  },
  "resources": [
    {
      "name": "[variables('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2021-03-08",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[variables('workbookFullDisplayName')]",
        "serializedData": "[string(variables('workbookContent'))]",
        "version": "1.0",
        "sourceId": "[variables('workbookSourceId')]",
        "category": "[variables('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', variables('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}